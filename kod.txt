from datetime import datetime, date

class Medicine:
    def __init__(self, name: str, price: float, quantity: int,
                 is_prescription: bool, expiration_date: date):
        self._name = name
        self._price = price
        self._quantity = quantity
        self._is_prescription = is_prescription
        self._expiration_date = expiration_date

    @property
    def name(self):
        return self._name

    @name.setter
    def name(self, value: str):
        self._name = value

    @property
    def price(self):
        return self._price

    @price.setter
    def price(self, value: float):
        if value < 0:
            raise ValueError("Ціна не може бути від’ємною")
        self._price = value

    @property
    def quantity(self):
        return self._quantity

    @quantity.setter
    def quantity(self, value: int):
        if value < 0:
            raise ValueError("Кількість не може бути від’ємною")
        self._quantity = value

    @property
    def is_prescription(self):
        return self._is_prescription

    @is_prescription.setter
    def is_prescription(self, value: bool):
        self._is_prescription = bool(value)

    @property
    def expiration_date(self):
        return self._expiration_date

    @expiration_date.setter
    def expiration_date(self, value: date):
        self._expiration_date = value

    def is_expired(self, current_date: date) -> bool:
        return self._expiration_date < current_date

    def apply_discount(self, percent: float):
        self.price = self.price * (1 - percent / 100)

    def __str__(self):
        return (f"Назва: {self.name}, ціна: {self.price:.2f} грн, "
                f"кількість: {self.quantity}, рецепт: "
                f"{'так' if self.is_prescription else 'ні'}, "
                f"придатні до: {self.expiration_date.isoformat()}")

    def __del__(self):
        pass


class Pharmacy:
    def __init__(self, name: str):
        self._name = name
        self._medicines: list[Medicine] = []

    def add_medicine(self, medicine: Medicine):
        self._medicines.append(medicine)

    def remove_medicine_by_name(self, name: str):
        before = len(self._medicines)
        self._medicines = [m for m in self._medicines if m.name != name]
        removed = before - len(self._medicines)
        print(f"Видалено {removed} позицій '{name}'")

    def remove_expired(self, current_date: date):
        before = len(self._medicines)
        self._medicines = [m for m in self._medicines if not m.is_expired(current_date)]
        removed = before - len(self._medicines)
        print(f"Під час переобліку видалено {removed} прострочених позицій")

    def apply_discount_to_all(self, percent: float = 10.0):
        for m in self._medicines:
            m.apply_discount(percent)

    def get_cheapest_medicines(self) -> list[Medicine]:
        if not self._medicines:
            return []
        min_price = min(m.price for m in self._medicines)
        return [m for m in self._medicines if abs(m.price - min_price) < 1e-9]

    def show_all_medicines(self):
        print(f"\nАсортимент аптеки '{self._name}':")
        if not self._medicines:
            print("  (порожньо)")
        for m in self._medicines:
            print("  -", m)


def parse_date(date_str: str) -> date:
    return datetime.strptime(date_str, "%Y-%m-%d").date()


def main():
    today = date.today()

    pharmacy = Pharmacy("Здорова сім'я")

    med1 = Medicine("Парацетамол", 80.0, 50, False, parse_date("2026-01-01"))
    med2 = Medicine("Антибіотик А", 250.0, 20, True, parse_date("2024-05-01"))
    med3 = Medicine("Вітамін C", 60.0, 100, False, parse_date("2023-12-01"))
    med4 = Medicine("Сироп від кашлю", 120.0, 30, False, parse_date("2025-07-15"))

    pharmacy.add_medicine(med1)
    pharmacy.add_medicine(med2)
    pharmacy.add_medicine(med3)
    pharmacy.add_medicine(med4)

    print("Початковий асортимент:")
    pharmacy.show_all_medicines()

    print("\n=== Переоблік (видалення прострочених ліків) ===")
    pharmacy.remove_expired(today)
    pharmacy.show_all_medicines()

    print("\n=== Застосування знижки 10% на всі ліки ===")
    pharmacy.apply_discount_to_all(10.0)
    pharmacy.show_all_medicines()

    print("\n=== Найдешевші ліки в аптеці ===")
    cheapest = pharmacy.get_cheapest_medicines()
    if not cheapest:
        print("Немає ліків.")
    else:
        for m in cheapest:
            print("  *", m)

    print("\n=== Видалення препарату 'Парацетамол' ===")
    pharmacy.remove_medicine_by_name("Парацетамол")
    pharmacy.show_all_medicines()


if __name__ == "__main__":
    main()